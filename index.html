<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Analizador de Panic MacPartsRepair</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f4ff;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 1rem;
      font-family: monospace;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      resize: vertical;
      background-color: #fdfdfd;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #3366ff;
      color: white;
      border: none;
      border-radius: 8px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #254eda;
    }
    #resultado {
      margin-top: 1rem;
      font-weight: bold;
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 8px;
      white-space: pre-wrap;
    }
    #progresoOCR {
      margin-top: 1rem;
      height: 20px;
      background: #ddd;
      border-radius: 10px;
      overflow: hidden;
      display: none;
    }
    #progresoOCR > div {
      height: 100%;
      width: 0%;
      background: #3366ff;
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Apple_logo_black.svg/60px-Apple_logo_black.svg.png" alt="Logo" style="vertical-align:middle;margin-right:10px;height:40px;">
<span style="font-size:1.8em;font-weight:bold;vertical-align:middle;">Analizador de Panic MacPartsRepair</span>
  <p>Pega el texto del Panic Full abajo:</p>
  <textarea id="panicText" placeholder="Pega aquÃ­ el log del panic..."></textarea>
  <button id="btnAnalizar" onclick="analizarPanic()" disabled>Analizar</button>
  <button onclick="limpiar()">Limpiar</button>
  <div id="resultado"></div>
<button onclick="copiarResultado()">ğŸ“‹ Copiar resultado</button>
  <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
  <div>
    <h2>Subir imagen del panic</h2>
    <label style="display:inline-block;padding:10px 20px;background:#4CAF50;color:white;border-radius:8px;cursor:pointer;">
ğŸ“· Subir imagen del panic
<input type="file" accept="image/*" onchange="leerImagen(event)" style="display:none;" />
</label>
  </div>
  <div>
    <h2>Cargar archivo .ips</h2>
    <label style="display:inline-block;padding:10px 20px;background:#2196F3;color:white;border-radius:8px;cursor:pointer;">
ğŸ“„ Cargar archivo .ips
<input type="file" id="archivoPanic" accept=".txt,.ips" onchange="leerArchivo(event)" style="display:none;" />
</label>
  </div>
</div>
  <p id="mensajeOCR" style="display:none;font-weight:bold;margin-top:1rem;">Reconociendo texto...</p>
<div id="progresoOCR"><div></div></div>
  <script>
    function analizarPanic() {
      const archivo = document.getElementById('archivoPanic').files[0];
      if (archivo) {
        const lector = new FileReader();
        lector.onload = function(e) {
          const contenido = e.target.result;
          procesarTexto(contenido);
        };
        lector.readAsText(archivo);
      } else {
        const contenidoManual = document.getElementById('panicText').value;
        procesarTexto(contenidoManual);
      }
    }

    function copiarResultado() {
  const resultado = document.getElementById('resultado').innerText;
  navigator.clipboard.writeText(resultado)
    .then(() => alert('Resultado copiado al portapapeles'))
    .catch(() => alert('No se pudo copiar el texto'));
}

function limpiar() {
      document.getElementById('panicText').value = "";
      const fileInput = document.getElementById('archivoPanic');
      const nuevoInput = fileInput.cloneNode(true);
      nuevoInput.id = "archivoPanic";
      nuevoInput.setAttribute("onchange", "leerArchivo(event)");
      fileInput.parentNode.replaceChild(nuevoInput, fileInput);
      document.getElementById('resultado').innerHTML = "";
      document.getElementById('progresoOCR').style.display = "none";
      alert("Campos limpiados. Puedes comenzar un nuevo anÃ¡lisis.");
    }

    function leerArchivo(event) {
      const archivo = event.target.files[0];
      if (!archivo) return;
      const lector = new FileReader();
      lector.onload = function(e) {
        procesarTexto(e.target.result);
      };
      lector.readAsText(archivo);
    }

    function leerImagen(event) {
      const archivo = event.target.files[0];
      if (!archivo) return;
      const lector = new FileReader();
      lector.onload = function(e) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = img.width * 2;
          canvas.height = img.height * 2;
          ctx.filter = 'contrast(150%) grayscale(0%)';
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          document.getElementById('progresoOCR').style.display = 'block';
document.getElementById('mensajeOCR').style.display = 'block';
const barra = document.querySelector('#progresoOCR > div');
if (!document.getElementById('porcentajeOCR')) {
  const porcentaje = document.createElement('span');
  porcentaje.id = 'porcentajeOCR';
  porcentaje.style.marginLeft = '10px';
  porcentaje.style.fontWeight = 'bold';
  document.getElementById('progresoOCR').appendChild(porcentaje);
}
          Tesseract.recognize(canvas, 'eng', {
            logger: m => {
              if (m.status === 'recognizing text') {
                barra.style.width = Math.round(m.progress * 100) + '%';
document.getElementById('porcentajeOCR').innerText = Math.round(m.progress * 100) + '%';
              }
            }
          })
          .then(({ data: { text } }) => {
            document.getElementById('panicText').value = text;
document.getElementById('btnAnalizar').disabled = false;
            document.getElementById('progresoOCR').style.display = 'none';
document.getElementById('mensajeOCR').style.display = 'none';
document.getElementById('porcentajeOCR').innerText = '';
            alert("Texto reconocido. Puedes revisarlo o modificarlo antes de analizar.");
          })
          .catch(err => {
            document.getElementById('progresoOCR').style.display = 'none';
            alert("Error al procesar imagen con OCR: " + err);
          });
        };
        img.src = e.target.result;
      };
      lector.readAsDataURL(archivo);
    }

    function procesarTexto(textoOriginal) {
      const texto = textoOriginal.toLowerCase();
      let resultado = "No se detectÃ³ una falla clara. Revisa que el panic estÃ© completo.";
      if (texto.includes("mic1")) resultado = `ğŸ¤ Fallo: mic1 detectado.\nğŸ‘‰ Revisa el flex del puerto de carga. En iPhone SE 2020 tambiÃ©n podrÃ­a ser una falla de placa.`;
      else if (texto.includes("mic2")) resultado = `ğŸ¤ Fallo: mic2 detectado.\nğŸ‘‰ Revisa el flex del botÃ³n de encendido.`;
      else if (texto.includes("prs0")) resultado = `ğŸ§ª Fallo: prs0 detectado.\nğŸ‘‰ Revisa el flex del puerto de carga.`;
      else if (texto.includes("nand") || texto.includes("ans2")) resultado = `ğŸ’¾ Fallo: Problema con la memoria NAND.\nğŸ‘‰ El almacenamiento puede estar daÃ±ado o tener un fallo lÃ³gico.`;
      else if (texto.includes("0x800")) resultado = `ğŸ”Œ Fallo: 0x800 detectado.\nğŸ‘‰ Revisa el flex del puerto de carga.`;
      else if (texto.includes("0x1000")) resultado = `ğŸ‘ƒ Fallo: 0x1000 detectado.\nğŸ‘‰ Revisa el flex del sensor de proximidad.`;
      else if (texto.includes("0x1800")) resultado = `ğŸ“¦ Fallo: 0x1800 detectado.\nğŸ‘‰ Revisa tanto el flex del puerto de carga como el del sensor de proximidad.`;
      else if (texto.includes("0x400")) resultado = `ğŸ§© Fallo: 0x400 detectado.\nğŸ‘‰ Posible separaciÃ³n entre capas (sandwich separation).`;
      else if (texto.includes("0x400000")) resultado = `ğŸ“¡ Fallo: 0x400000 detectado.\nğŸ‘‰ Revisa el flex de carga inalÃ¡mbrica (vidrio trasero).`;
      else if (texto.includes("0x100000")) resultado = `ğŸ”Œ Fallo: 0x100000 detectado.\nğŸ‘‰ Revisa el flex del puerto de carga.`;
      else if (texto.includes("0x500000")) resultado = `ğŸ“³ Fallo: 0x500000 detectado.\nğŸ‘‰ Revisa el taptic engine, el puerto de carga o comunicaciÃ³n con la baterÃ­a.`;
      else if (texto.includes("0x200000")) resultado = `ğŸ‘ƒ Fallo: 0x200000 detectado.\nğŸ‘‰ Revisa el flex del sensor de proximidad o carga inalÃ¡mbrica en modelos recientes.`;
      else if (texto.includes("0xa1")) resultado = `ğŸ”‹ Fallo: 0xa1 detectado.\nğŸ‘‰ Revisa la baterÃ­a en modelos iPhone 15 Pro o Pro Max.`;
      else if (texto.includes("0x300000")) resultado = `ğŸ”Œ Fallo: 0x300000 detectado.\nğŸ‘‰ Revisa el flex del puerto de carga.`;
      else if (texto.includes("0x700000")) resultado = `ğŸ”„ Fallo: 0x700000 detectado.\nğŸ‘‰ Revisa tanto el flex del puerto de carga como el de carga inalÃ¡mbrica.`;
      else if (texto.includes("tgob") || texto.includes("tg0b")) resultado = `ğŸŒ¡ï¸ Fallo: TGOB no detectado.\nğŸ‘‰ Revisa la baterÃ­a o el sensor de temperatura (termistor). Puede ser una baterÃ­a genÃ©rica, el conector suelto o daÃ±o en la lÃ­nea de comunicaciÃ³n.`;
      else if (texto.includes("thermalmonitord") || texto.includes("watchdog timeout")) resultado = `ğŸ§­ Fallo: Watchdog o Thermalmonitord.\nğŸ‘‰ El sistema no recibe respuesta del monitoreo tÃ©rmico. Puede ser baterÃ­a en mal estado o falla de lÃ­nea de control en circuito de carga.`;
      document.getElementById('resultado').innerText = resultado;
    }
  </script>
<footer style="margin-top:2rem;text-align:center;font-size:0.9em;color:#555;"><a href="https://wa.me/+573504980938" target="_blank" style="color:#3366ff;text-decoration:none;"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" style="width:18px;height:18px;vertical-align:middle;margin-right:6px;">Desarrollado por Alejandro Escalante Â© 2025</a></footer>

</body>
</html>
